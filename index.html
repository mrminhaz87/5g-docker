<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scapy Web Packet Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        #app { max-width: 1200px; margin: 0 auto; }
        .packet-list { height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; }
        .packet-item { cursor: pointer; padding: 5px; border-bottom: 1px solid #eee; }
        .packet-item:hover { background-color: #f0f0f0; }
        .packet-details { margin-top: 20px; border: 1px solid #ccc; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="app">
        <h1>Scapy Web Packet Analyzer</h1>
        <button @click="startSniffing" :disabled="sniffing">Start Sniffing</button>
        <button @click="stopSniffing" :disabled="!sniffing">Stop Sniffing</button>
        <div class="packet-list">
            <div v-for="(packet, index) in packets" :key="index" class="packet-item" @click="showDetails(index)">
                {{ packet.summary }}
            </div>
        </div>
        <div v-if="selectedPacket" class="packet-details">
            <h3>Packet Details:</h3>
            <pre>{{ JSON.stringify(selectedPacket.details, null, 2) }}</pre>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                packets: [],
                sniffing: false,
                selectedPacket: null,
                pollInterval: null
            },
            methods: {
                startSniffing() {
                    axios.post('/start').then(() => {
                        this.sniffing = true;
                        this.pollPackets();
                    });
                },
                stopSniffing() {
                    axios.post('/stop').then(() => {
                        this.sniffing = false;
                        clearInterval(this.pollInterval);
                    });
                },
                pollPackets() {
                    this.pollInterval = setInterval(() => {
                        axios.get(`/packets?start=${this.packets.length}`).then(response => {
                            this.packets.push(...response.data);
                        });
                    }, 1000);
                },
                showDetails(index) {
                    axios.get(`/packet/${index}`).then(response => {
                        this.selectedPacket = response.data;
                    });
                }
            }
        });
    </script>
</body>
</html>
